<Window x:Class="FTP_Tool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:FTP_Tool.Models"
        xmlns:local="clr-namespace:FTP_Tool"
        Title="FTP File Monitor - Linux to Windows" Height="700" Width="1200" MinWidth="900" MinHeight="600"
        FontFamily="Segoe UI" Background="#F3F2F1" StateChanged="Window_StateChanged">

    <Window.Resources>
        <!-- Modern Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#106EBE"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#005A9E"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Background" Value="#E1E1E1"/>
                                <Setter Property="Foreground" Value="#888"/>
                                <Setter Property="Cursor" Value="Arrow"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button Style -->
        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="#323130"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F3F2F1"/>
                    <Setter Property="BorderBrush" Value="#C8C6C4"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#EDEBE9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Danger Button Style -->
        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#D13438"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#B02E31"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#A2262A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Sidebar Navigation Button Style -->
        <Style x:Key="NavButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#605E5C"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,16"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="0,25,25,0"
                                Margin="0,0,16,4">
                            <StackPanel Orientation="Horizontal">
                                <ContentPresenter/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#F3F2F1"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#EDEBE9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Active Navigation Button Style -->
        <Style x:Key="NavButtonActive" TargetType="Button" BasedOn="{StaticResource NavButton}">
            <Setter Property="Background" Value="#E3F2FD"/>
            <Setter Property="Foreground" Value="#0078D4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- Modern Card Style -->
        <Style x:Key="ModernCard" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E1DFDD"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" Opacity="0.1" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern TextBox Style -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="4" SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" 
                                          HorizontalScrollBarVisibility="Hidden" 
                                          VerticalScrollBarVisibility="Hidden"
                                          Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="true">
                                <Setter TargetName="border" Property="BorderBrush" Value="#0078D4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern PasswordBox Style -->
        <Style x:Key="ModernPasswordBox" TargetType="PasswordBox">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="PasswordBox">
                        <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="4" SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" 
                                          HorizontalScrollBarVisibility="Hidden" 
                                          VerticalScrollBarVisibility="Hidden"
                                          Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="true">
                                <Setter TargetName="border" Property="BorderBrush" Value="#0078D4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Text Styles -->
        <Style x:Key="HeaderText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#323130"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <Style x:Key="LabelText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#605E5C"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="StatusText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#323130"/>
        </Style>

        <Style x:Key="PageTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#323130"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <Style x:Key="PageSubtitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#605E5C"/>
            <Setter Property="Margin" Value="0,0,0,24"/>
        </Style>

        <!-- Log entry DataTemplate -->
        <DataTemplate x:Key="LogEntryTemplate">
            <TextBlock Text="{Binding Formatted}" TextWrapping="Wrap">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Foreground" Value="#323130"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Level}" Value="Debug">
                                <Setter Property="Foreground" Value="#8A8A8A"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Level}" Value="Info">
                                <Setter Property="Foreground" Value="#6BB6FF"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                <Setter Property="Foreground" Value="#FFCC00"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                <Setter Property="Foreground" Value="#D13438"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="SidebarColumn" Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar Navigation -->
        <Border x:Name="SidebarBorder" Grid.Column="0" Background="#FAFAFA" BorderBrush="#E1DFDD" BorderThickness="0,0,1,0">
            <StackPanel>
                <!-- App Logo/Title -->
                <Border Background="#0078D4" Padding="20">
                    <StackPanel>
                        <TextBlock Text="FTP Monitor" FontSize="18" FontWeight="Bold" Foreground="White"/>
                        <TextBlock Text="File Transfer Tool" FontSize="12" Foreground="#E1F5FE"/>
                    </StackPanel>
                </Border>

                <!-- Navigation Menu -->
                <StackPanel Margin="0,20,0,0">
                    <Button x:Name="btnNavMonitor" Style="{StaticResource NavButtonActive}" Click="BtnNavMonitor_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📡" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Monitor" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="btnNavAlerts" Style="{StaticResource NavButton}" Click="BtnNavAlerts_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="🔔" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Alerts" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="btnNavSettings" Style="{StaticResource NavButton}" Click="BtnNavSettings_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⚙️" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="Settings" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="btnNavAbout" Style="{StaticResource NavButton}" Click="BtnNavAbout_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ℹ️" FontSize="16" Margin="0,0,12,0"/>
                            <TextBlock Text="About" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Bottom Status -->
                <StackPanel VerticalAlignment="Bottom" Margin="20" Background="White"
                           Height="100">
                    <Border CornerRadius="4" Padding="12" Background="#F8F9FA">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <Ellipse x:Name="ellipseNavStatus" Width="8" Height="8" Fill="#6BB6FF" 
                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock x:Name="txtNavStatus" Text="Ready" FontSize="12" FontWeight="SemiBold"/>
                            </StackPanel>
                            
                            <TextBlock x:Name="txtNavFiles" Text="No files monitored" FontSize="11" Foreground="#605E55" Margin="0,2,0,0"/>
                            <TextBlock x:Name="txtNavRemote" Text="Remote: 0 files" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                            <TextBlock x:Name="txtNavErrors" Text="Errors: 0" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                            <TextBlock x:Name="txtNavLastCheck" Text="Last: Never" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                            <TextBlock x:Name="txtNavLastAlert" Text="Last alert: -" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1" Margin="20">
            <!-- Toggle button that appears on small windows (moved to top-right) -->
            <Button x:Name="btnToggleSidebar"  Visibility="Collapsed" Width="40" Height="36" HorizontalAlignment="Right" VerticalAlignment="Top" Click="BtnToggleSidebar_Click" ToolTip="Show menu" Margin="0,8,12,0" Panel.ZIndex="100" Background="Transparent" >
                <TextBlock Text="☰" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Button>

            <!-- Monitor Page (Default) -->
            <Grid x:Name="MonitorPage" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Page Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,20" HorizontalAlignment="Center" MaxWidth="900">
                    <TextBlock Text="FTP Monitor" Style="{StaticResource PageTitle}" TextAlignment="Center"/>
                    <TextBlock Text="Monitor and download files from FTP server automatically" 
                   Style="{StaticResource PageSubtitle}" TextAlignment="Center"/>
                </StackPanel>

                <!-- Monitor Content - Responsive Grid -->
                <Grid Grid.Row="1" x:Name="MainContentGrid">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" MinWidth="350" MaxWidth="500"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="1.5*" MinWidth="400"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Panel: Connection + Settings -->
                    <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled" Padding="0,0,8,0">
                        <StackPanel>
                            <!-- Connection Settings -->
                            <Border Style="{StaticResource ModernCard}">
                                <StackPanel>
                                    <TextBlock Text="Server Connection" Style="{StaticResource HeaderText}" 
                                   FontSize="16" FontWeight="SemiBold"/>

                                    <StackPanel Margin="0,12,0,0">
                                        <!-- Server & Port Row -->
                                        <Grid Margin="0,0,0,12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="100"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="Server Address" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                                <TextBox x:Name="txtHost" Style="{StaticResource ModernTextBox}" 
                                             ToolTip="FTP server hostname or IP address"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Port" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                                <TextBox x:Name="txtPort" Text="21" Style="{StaticResource ModernTextBox}"
                                             ToolTip="FTP port (default: 21)"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Username -->
                                        <StackPanel Margin="0,0,0,12">
                                            <TextBlock Text="Username" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                            <TextBox x:Name="txtUsername" Style="{StaticResource ModernTextBox}"/>
                                        </StackPanel>

                                        <!-- Password -->
                                        <StackPanel Margin="0,0,0,12">
                                            <TextBlock Text="Password" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                            <PasswordBox x:Name="txtPassword" Style="{StaticResource ModernPasswordBox}"/>
                                        </StackPanel>

                                        <!-- Remote Folder & Test Button -->
                                        <Grid Margin="0,0,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="Remote Path" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                                <TextBox x:Name="txtRemoteFolder" Text="/" Style="{StaticResource ModernTextBox}"
                                             ToolTip="Remote folder path (e.g., /incoming)"/>
                                            </StackPanel>

                                            <!-- Updated: Test button with clearer tooltip and small caption -->
                                            <StackPanel Grid.Column="2" Margin="0,20,0,0" HorizontalAlignment="Right">
                                                <Button x:Name="btnTestConnection" Click="BtnTestConnection_Click" 
                                                Style="{StaticResource SecondaryButton}" Padding="12,8"
                                                ToolTip="Test connection to FTP server. On success the host, username and password will be saved securely to Windows Credential Manager.">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="🔗" Margin="0,0,6,0"/>
                                                        <TextBlock Text="Test"/>
                                                    </StackPanel>
                                                </Button>
                                                <TextBlock Text="(Test also saves credentials if it succeeds)" FontSize="11" Foreground="#605E5C" Margin="4,6,0,0" HorizontalAlignment="Center" TextWrapping="Wrap" Width="140" TextAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Download Settings -->
                            <Border Style="{StaticResource ModernCard}">
                                <StackPanel>
                                    <TextBlock Text="Download Settings" Style="{StaticResource HeaderText}" 
                                   FontSize="16" FontWeight="SemiBold"/>

                                    <StackPanel Margin="0,12,0,0">
                                        <!-- Local Folder -->
                                        <StackPanel Margin="0,0,0,12">
                                            <TextBlock Text="Local Download Folder" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="8"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtLocalFolder" Grid.Column="0" Style="{StaticResource ModernTextBox}"/>
                                                <Button x:Name="btnBrowse" Grid.Column="2" Click="BtnBrowse_Click" 
                                            Style="{StaticResource SecondaryButton}" Padding="10,8" ToolTip="Browse Download Folder">
                                                    <TextBlock Text="📂"/>
                                                </Button>
                                            </Grid>
                                        </StackPanel>

                                        <!-- Check Interval -->
                                        <StackPanel Margin="0,0,0,12">
                                            <TextBlock Text="Check Interval" Style="{StaticResource LabelText}" Margin="0,0,0,4"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox x:Name="txtInterval" Width="auto" MaxWidth="100" Text="30" 
                                             Style="{StaticResource ModernTextBox}"
                                             ToolTip="How often to check for new files (in seconds)"/>
                                                <TextBlock Text="seconds" Style="{StaticResource LabelText}" 
                                               Margin="10,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Delete After Download -->
                                        <CheckBox x:Name="chkDeleteAfterDownload" 
                                      Content="Delete files after download" 
                                      FontSize="14" Margin="0,4,0,0"
                                      ToolTip="Remove files from server after successful download"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Control Buttons -->
                            <Border Style="{StaticResource ModernCard}">
                                <StackPanel>
                                    <TextBlock Text="Controls" Style="{StaticResource HeaderText}" 
                                   FontSize="16" FontWeight="SemiBold"/>

                                    <!-- Primary Actions -->
                                    <UniformGrid Columns="2" Rows="1" Margin="0,12,0,8">
                                        <Button x:Name="btnStart" Click="BtnStart_Click" 
                                    Style="{StaticResource ModernButton}" Margin="0,0,4,0">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="▶" Margin="0,0,6,0" FontSize="14"/>
                                                <TextBlock Text="Start Monitor"/>
                                            </StackPanel>
                                        </Button>

                                        <Button x:Name="btnStop" Click="BtnStop_Click" IsEnabled="False" 
                                    Style="{StaticResource DangerButton}" Margin="4,0,0,0">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="⏹" Margin="0,0,6,0" FontSize="14"/>
                                                <TextBlock Text="Stop"/>
                                            </StackPanel>
                                        </Button>
                                    </UniformGrid>

                                    <!-- Secondary Actions -->
                                    <UniformGrid Columns="3" Rows="1">
                                        <Button x:Name="btnCheckNow" Click="BtnCheckNow_Click" 
                                    Style="{StaticResource SecondaryButton}" Margin="0,0,4,0" Padding="8,8" ToolTip="Check Now">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock Text="🔄" FontSize="14"/>
                                            </StackPanel>
                                        </Button>

                                        <Button x:Name="btnClearLog" Click="BtnClearLog_Click" 
                                    Style="{StaticResource SecondaryButton}" Margin="2,0" Padding="8,8" ToolTip="Clear Logs">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock Text="🗑️" FontSize="14"/>
                                            </StackPanel>
                                        </Button>

                                        <Button x:Name="btnOpenLogFolder" Click="BtnOpenLogFolder_Click" 
                                    Style="{StaticResource SecondaryButton}" Margin="4,0,0,0" Padding="8,8" ToolTip="Open Logs Folder">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock Text="📂" FontSize="14"/>
                                            </StackPanel>
                                        </Button>
                                    </UniformGrid>

                                    <!-- Status Bar -->
                                    <Border Background="#F5F5F5" CornerRadius="6" Padding="12" Margin="0,12,0,0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock x:Name="lblStatus" Text="Ready" 
                                               Style="{StaticResource StatusText}" 
                                               FontWeight="SemiBold" FontSize="13"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1">
                                                <TextBlock x:Name="lblDownloaded" Text="0 files" 
                                               Foreground="#107C10" FontWeight="SemiBold" FontSize="13"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Splitter -->
                    <GridSplitter Grid.Column="1" Width="8" HorizontalAlignment="Center" 
                      VerticalAlignment="Stretch" Background="Transparent" 
                      ShowsPreview="True" Margin="4,0"/>

                    <!-- Right Panel: Status & Activity Log -->
                    <Grid Grid.Column="2" Margin="8,0,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Status Overview - Compact Design -->
                        <Border Grid.Row="0" Style="{StaticResource ModernCard}" Padding="16,14">
                            <StackPanel>
                                <TextBlock Text="Status Overview" Style="{StaticResource HeaderText}" 
                               FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" MinWidth="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Current Status with Indicator -->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,8">
                                        <Ellipse x:Name="ellipseStatus" Width="12" Height="12" 
                                     Fill="#6BB6FF" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <TextBlock Text="Status:" FontWeight="SemiBold" 
                                       Style="{StaticResource LabelText}"/>
                                    </StackPanel>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="txtStatusText" 
                                   Text="Idle" Style="{StaticResource StatusText}" 
                                   FontWeight="SemiBold" Margin="0,0,0,8" VerticalAlignment="Center"/>

                                    <!-- Last Check -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Last check:" 
                                   FontWeight="SemiBold" Style="{StaticResource LabelText}" 
                                   Margin="22,0,0,8"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="txtLastCheck" 
                                   Text="-" Style="{StaticResource StatusText}" 
                                   Margin="0,0,0,8"/>

                                    <!-- Last Error -->
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Last error:" 
                                   FontWeight="SemiBold" Style="{StaticResource LabelText}" 
                                   Margin="22,0,0,0" VerticalAlignment="Top"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="txtLastError" 
                                   Text="-" Foreground="#D13438" TextWrapping="Wrap" 
                                   Style="{StaticResource StatusText}" MaxHeight="60"
                                   ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>

                                    <!-- Last Alert (new) -->
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Last alert:" 
                                   FontWeight="SemiBold" Style="{StaticResource LabelText}" 
                                   Margin="22,0,0,0" VerticalAlignment="Top"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" x:Name="txtLastAlert" 
                                   Text="-" Foreground="#FF8C00" TextWrapping="Wrap" 
                                   Style="{StaticResource StatusText}" MaxHeight="60"
                                   ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Activity Log -->
                        <Border Grid.Row="1" Style="{StaticResource ModernCard}" Margin="0,8,0,0">
                            <DockPanel>
                                <Grid DockPanel.Dock="Top" Margin="0,0,0,8">
                                    <TextBlock Text="Activity Log" Style="{StaticResource HeaderText}" 
                                   FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <Button x:Name="btnJumpToLatest" HorizontalAlignment="Right" 
                                Visibility="Collapsed" Click="BtnJumpToLatest_Click" 
                                Style="{StaticResource SecondaryButton}" Padding="8,4"
                                FontSize="12">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="↓" Margin="0,0,4,0"/>
                                            <TextBlock Text="Latest"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>

                                <!-- Log ListBox with better styling -->
                                <Border BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" 
                            Background="#FAFAFA">
                                    <ListBox x:Name="lstLog" 
                                 ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DisplayedLogEntriesPublic}"
                                 ItemTemplate="{StaticResource LogEntryTemplate}" 
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 VirtualizingPanel.IsVirtualizing="True"
                                 VirtualizingPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.CanContentScroll="True"
                                 Background="Transparent"
                                 BorderThickness="0">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel />
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                    </ListBox>
                                </Border>
                            </DockPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>

            <!-- Settings Page -->
            <Grid x:Name="SettingsPage" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Page Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                    <TextBlock Text="Settings" Style="{StaticResource PageTitle}"/>
                    <TextBlock Text="Configure application preferences and advanced options" Style="{StaticResource PageSubtitle}"/>
                </StackPanel>

                <!-- Settings Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel MaxWidth="600" HorizontalAlignment="Left">
                        <!-- General Settings -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="🎛️ General Settings" Style="{StaticResource HeaderText}"/>
                                <CheckBox x:Name="chkAutoStart" Content="Start application with Windows" FontSize="14" Margin="0,0,0,12" ToolTip="Add or remove FTP Monitor from Windows startup. When enabled the app will be launched automatically when you sign in."/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock VerticalAlignment="Center" Text="Startup behavior:" Margin="0,0,12,0"/>
                                    <ComboBox x:Name="cmbStartupMode" Width="220" FontSize="14" ToolTip="Choose whether the app should open the main window or start minimized to tray when launched by Windows at login.">
                                        <ComboBoxItem Content="Open window"/>
                                        <ComboBoxItem Content="Start minimized to tray"/>
                                    </ComboBox>
                                </StackPanel>
                                <CheckBox x:Name="chkMinimizeToTray" Content="Minimize to system tray when closed" FontSize="14" Margin="0,0,0,12" ToolTip="When enabled, closing the window hides the app to the system tray. Use the tray icon to restore or exit."/>
                                <CheckBox x:Name="chkStartMonitoringOnLaunch" Content="Start monitoring automatically when application starts" FontSize="14" Margin="0,0,0,12"/>
                                <!--<CheckBox Content="Show desktop notifications for downloads" FontSize="14" Margin="0,0,0,12"/>-->
                                <!--<CheckBox Content="Play sound when files are downloaded" FontSize="14"/>-->
                            </StackPanel>
                        </Border>

                        <!-- FTP Settings -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="⚡ FTP Settings" Style="{StaticResource HeaderText}"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Connection timeout:" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,12">
                                        <TextBox x:Name="txtConnectionTimeout" Width="auto" MaxWidth="100" Text="30" Style="{StaticResource ModernTextBox}"/>
                                        <TextBlock Text="seconds" Style="{StaticResource LabelText}" Margin="10,0,0,0"/>
                                    </StackPanel>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Max retry attempts:" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <TextBox x:Name="txtMaxRetries" Grid.Row="1" Grid.Column="1" Width="auto" MaxWidth="100" Text="3" Style="{StaticResource ModernTextBox}" HorizontalAlignment="Left" Margin="0,0,0,12"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Passive FTP mode:" Style="{StaticResource LabelText}" Margin="0,0,10,0"/>
                                    <CheckBox x:Name="chkUsePassiveMode" Grid.Row="3" Grid.Column="1" Content="Use passive mode (recommended)" FontSize="14"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- File Handling -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="📄 File Handling" Style="{StaticResource HeaderText}"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="File filters:" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="*.txt;*.pdf;*.doc" Style="{StaticResource ModernTextBox}" Margin="0,0,0,12"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Duplicate handling:" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <ComboBox Grid.Row="1" Grid.Column="1" SelectedIndex="0" Margin="0,0,0,12">
                                        <ComboBoxItem Content="Skip existing files"/>
                                        <ComboBoxItem Content="Overwrite existing files"/>
                                        <ComboBoxItem Content="Rename with timestamp"/>
                                    </ComboBox>

                                    <CheckBox Grid.Row="2" Grid.ColumnSpan="2" Content="Create subfolders based on date" FontSize="14"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Logging Settings -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="📝 Logging Settings" Style="{StaticResource HeaderText}"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Write logs to file:" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <CheckBox x:Name="chkLogToFile" Grid.Row="0" Grid.Column="1" Content="Enable writing logs to activity log file" FontSize="14" Margin="0,0,0,12"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Minimum log level:" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <ComboBox x:Name="cmbMinimumLogLevel" Grid.Row="1" Grid.Column="1" Width="200" Margin="0,0,0,12">
                                        <ComboBoxItem Content="Debug"/>
                                        <ComboBoxItem Content="Info"/>
                                        <ComboBoxItem Content="Warning"/>
                                        <ComboBoxItem Content="Error"/>
                                    </ComboBox>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Log retention (days):" Style="{StaticResource LabelText}" Margin="0,0,10,12"/>
                                    <TextBox x:Name="txtLogRetentionDays" Grid.Row="2" Grid.Column="1" Width="80" Text="30" Style="{StaticResource ModernTextBox}" HorizontalAlignment="Left" Margin="0,0,0,12"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Max UI log lines:" Style="{StaticResource LabelText}" Margin="0,0,10,0"/>
                                    <TextBox x:Name="txtMaxLogLines" Grid.Row="3" Grid.Column="1" Width="120" Style="{StaticResource ModernTextBox}"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Saved Credentials Management -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="🔐 Saved Credentials" Style="{StaticResource HeaderText}"/>
                                <TextBlock Text="Manage saved FTP credentials stored in Windows Credential Manager." Margin="0,0,0,8" Foreground="#605E5C"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <ListBox x:Name="lstSavedCredentials" Grid.Row="1" MinHeight="100" Margin="0,8,0,8"/>

                                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left">
                                        <Button x:Name="btnRefreshCredentials" Click="BtnRefreshCredentials_Click" Style="{StaticResource SecondaryButton}" Margin="0,0,8,0">Refresh</Button>
                                        <Button x:Name="btnDeleteCredential" Click="BtnDeleteSavedCredential_Click" Style="{StaticResource DangerButton}">Delete Selected</Button>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- Improved Alerts Page -->
            <Grid x:Name="AlertsPage" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Page Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,24">
                    <TextBlock Text="Alerts &amp; Notifications" Style="{StaticResource PageTitle}"/>
                    <TextBlock Text="Configure email notifications and alert schedules to stay informed about download activities" 
                   Style="{StaticResource PageSubtitle}" TextWrapping="Wrap"/>
                </StackPanel>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel MaxWidth="800">

                        <!-- Email Configuration Section -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                    <TextBlock Text="✉️" FontSize="18" VerticalAlignment="Center"/>
                                    <TextBlock Text="Email Configuration" Style="{StaticResource HeaderText}" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>

                                <TextBlock Text="Configure SMTP settings for sending email notifications" 
                               Foreground="#605E5C" FontSize="13" Margin="0,-8,0,8"/>

                                <!-- SMTP Settings Grid -->
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- SMTP Host -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="SMTP Server:" Style="{StaticResource LabelText}" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtSmtpHost" Grid.Row="0" Grid.Column="1" 
                                 Style="{StaticResource ModernTextBox}" 
                                 ToolTip="Enter your SMTP server address (e.g., smtp.gmail.com)"/>

                                    <!-- Port and SSL in same row -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Port / SSL:" Style="{StaticResource LabelText}" VerticalAlignment="Center" Margin="0,12,0,0"/>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,12,0,0">
                                        <TextBox x:Name="txtSmtpPort" Text="587" Style="{StaticResource ModernTextBox}" Width="80"
                                     ToolTip="Common ports: 25, 587 (TLS), 465 (SSL)"/>
                                        <CheckBox x:Name="chkSmtpSsl" Content="Enable SSL/TLS" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                    </StackPanel>

                                    <!-- Credentials Section -->
                                    <Border Grid.Row="2" Grid.ColumnSpan="2" 
                                Background="#F8F9FA" CornerRadius="4" Padding="16" Margin="0,16,0,0">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="180"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Row="0" Grid.ColumnSpan="2" Text="Authentication" FontWeight="SemiBold" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Username:" Style="{StaticResource LabelText}" VerticalAlignment="Center"/>
                                            <TextBox x:Name="txtSmtpUser" Grid.Row="1" Grid.Column="1" Style="{StaticResource ModernTextBox}"/>

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Password:" Style="{StaticResource LabelText}" VerticalAlignment="Center" Margin="0,12,0,0"/>
                                            <PasswordBox x:Name="txtSmtpPass" Grid.Row="2" Grid.Column="1" Style="{StaticResource ModernPasswordBox}" Margin="0,12,0,0"/>
                                        </Grid>
                                    </Border>

                                    <!-- From Address -->
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="From Address:" Style="{StaticResource LabelText}" VerticalAlignment="Center" Margin="0,16,0,0"/>
                                    <TextBox x:Name="txtEmailFrom" Grid.Row="3" Grid.Column="1" Style="{StaticResource ModernTextBox}" Margin="0,16,0,0"
                                 ToolTip="Email address that will appear as sender"/>

                                    <!-- Recipients Section -->
                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Recipients:" Style="{StaticResource LabelText}" VerticalAlignment="Top" Margin="0,16,0,0"/>
                                    <StackPanel Grid.Row="4" Grid.Column="1" Margin="0,16,0,0">
                                        <Border BorderBrush="#E1E5E9" BorderThickness="1" CornerRadius="4" Padding="8">
                                            <StackPanel>
                                                <TextBlock Text="Email Recipients" FontSize="12" Foreground="#605E5C" Margin="0,0,0,4"/>
                                                <ListBox x:Name="lstEmailRecipients" Height="80" BorderThickness="0" Background="Transparent"/>
                                            </StackPanel>
                                        </Border>

                                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                            <TextBox x:Name="txtNewRecipient" Width="280" Style="{StaticResource ModernTextBox}" />
                                            <Button x:Name="btnAddRecipient" Click="BtnAddRecipient_Click" Style="{StaticResource SecondaryButton}" Margin="8,0,0,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="+" FontWeight="Bold" Margin="0,0,6,0"/>
                                                    <TextBlock Text="Add"/>
                                                </StackPanel>
                                            </Button>
                                            <Button x:Name="btnRemoveRecipient" Click="BtnRemoveRecipient_Click" Style="{StaticResource SecondaryButton}" Margin="8,0,0,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="−" FontWeight="Bold" Margin="0,0,6,0"/>
                                                    <TextBlock Text="Remove"/>
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Test Buttons -->
                                    <StackPanel Grid.Row="5" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,20,0,0" HorizontalAlignment="Left">
                                        <Button x:Name="btnTestEmail" Click="BtnTestEmail_Click" Style="{StaticResource SecondaryButton}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="📧" FontSize="14"/>
                                                <TextBlock Text="Test Email Connection" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </Button>

                                        <Button x:Name="btnTestAlert" Click="BtnTestAlert_Click" Style="{StaticResource SecondaryButton}" Margin="12,0,0,0">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="🚨" FontSize="14"/>
                                                <TextBlock Text="Send Test Alert" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Alert Schedule Section -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                        <TextBlock Text="⏰" FontSize="18" VerticalAlignment="Center"/>
                                        <TextBlock Text="Alert Schedule" Style="{StaticResource HeaderText}" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    <TextBlock Text="Configure when and what type of alerts to receive" Style="{StaticResource LabelText}" Margin="0,4,0,0"/>
                                </StackPanel>

                                <!-- Master Toggle -->
                                <Border Background="#E8F5E8" BorderBrush="#28A745" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,8,0,0">
                                    <CheckBox x:Name="chkAlertsEnabled" Content="Enable email alerts" FontSize="14" FontWeight="SemiBold"/>
                                </Border>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Alert Types -->
                                    <StackPanel Grid.Row="0" Margin="0,8,0,0">
                                        <TextBlock Text="Alert Types" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>
                                        <Border Background="#F8F9FA" CornerRadius="4" Padding="16">
                                            <StackPanel>
                                                <CheckBox x:Name="chkEmailErrors" Content="Errors (sent immediately)" FontWeight="SemiBold" Foreground="#DC3545" Margin="0,0,0,8"/>
                                                <CheckBox x:Name="chkEmailWarnings" Content="Warnings (sent immediately)" FontWeight="SemiBold" Foreground="#FD7E14" Margin="0,0,0,8"/>

                                                <StackPanel>
                                                    <CheckBox x:Name="chkEmailInfo" Content="Info summaries (batched)" FontWeight="SemiBold" Foreground="#007BFF"/>
                                                    <StackPanel Orientation="Horizontal" Margin="24,8,0,0">
                                                        <TextBlock Text="Send summary every:" VerticalAlignment="Center"/>
                                                        <TextBox x:Name="txtEmailSummaryInterval" Width="auto" MaxWidth="100" Text="60" Style="{StaticResource ModernTextBox}" Margin="8,0,0,0"/>
                                                        <TextBlock Text="minutes" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <!-- Schedule Settings -->
                                    <StackPanel Grid.Row="1" Margin="0,20,0,0">
                                        <TextBlock Text="Schedule Settings" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>

                                        <!-- All-time option prominently placed -->
                                        <Border Background="#FFF3CD" BorderBrush="#856404" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,12">
                                            <CheckBox x:Name="chkAlertAlways" Content="Send alerts 24/7 (ignore schedule below)" FontWeight="SemiBold"/>
                                        </Border>

                                        <!-- New: All-day option that also ignores lunch and work hours (styled blue) -->
                                        <Border Background="#E7F3FF" BorderBrush="#0078D4" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,12">
                                            <CheckBox x:Name="chkAllDay" Content="24 Hours (No lunch break) — send alerts all day" FontWeight="SemiBold"/>
                                        </Border>

                                        <!-- Days of week -->
                                        <StackPanel>
                                            <TextBlock Text="Active Days:" FontSize="13" Margin="0,0,0,8"/>
                                            <WrapPanel>
                                                <CheckBox x:Name="chkMon" Content="Monday" MinWidth="90" Margin="0,0,8,8"/>
                                                <CheckBox x:Name="chkTue" Content="Tuesday" MinWidth="90" Margin="0,0,8,8"/>
                                                <CheckBox x:Name="chkWed" Content="Wednesday" MinWidth="90" Margin="0,0,8,8"/>
                                                <CheckBox x:Name="chkThu" Content="Thursday" MinWidth="90" Margin="0,0,8,8"/>
                                                <CheckBox x:Name="chkFri" Content="Friday" MinWidth="90" Margin="0,0,8,8"/>
                                                <CheckBox x:Name="chkSat" Content="Saturday" MinWidth="90" Margin="0,0,8,8"/>
                                                <CheckBox x:Name="chkSun" Content="Sunday" MinWidth="90" Margin="0,0,8,8"/>
                                            </WrapPanel>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Time Settings -->
                                    <Grid Grid.Row="2" Margin="0,20,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Work Hours -->
                                        <Border Grid.Row="0" Grid.Column="0" Background="#F8F9FA" CornerRadius="4" Padding="16">
                                            <StackPanel>
                                                <TextBlock Text="Work Hours" FontWeight="SemiBold"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                    <TextBox x:Name="txtWorkStart" Width="auto" MaxWidth="100" Text="08:00" Style="{StaticResource ModernTextBox}"/>
                                                    <TextBlock Text="to" VerticalAlignment="Center" Margin="8,0"/>
                                                    <TextBox x:Name="txtWorkEnd" Width="auto" MaxWidth="100" Text="17:00" Style="{StaticResource ModernTextBox}" Margin="8,0,0,0"/>
                                                </StackPanel>
                                                <TextBlock Text="Alerts active during these hours" FontSize="11" Foreground="#605E5C" Margin="0,8,0,0"/>
                                            </StackPanel>
                                        </Border>

                                        <!-- Lunch Break -->
                                        <Border Grid.Row="0" Grid.Column="2" Background="#F8F9FA" CornerRadius="4" Padding="16">
                                            <StackPanel>
                                                <TextBlock Text="Lunch Break" FontWeight="SemiBold"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                    <TextBox x:Name="txtLunchStart" Width="auto" MaxWidth="100" Text="12:00" Style="{StaticResource ModernTextBox}"/>
                                                    <TextBlock Text="to" VerticalAlignment="Center" Margin="8,0"/>
                                                    <TextBox x:Name="txtLunchEnd" Width="auto" MaxWidth="100" Text="13:00" Style="{StaticResource ModernTextBox}" Margin="8,0,0,0"/>
                                                </StackPanel>
                                                <TextBlock Text="Alerts paused during lunch" FontSize="11" Foreground="#605E5C" Margin="0,8,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>

                                    <!-- Alert Threshold -->
                                    <StackPanel Grid.Row="3" Margin="0,20,0,0">
                                        <TextBlock Text="Alert Threshold" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>
                                        <Border Background="#F8F9FA" CornerRadius="4" Padding="16">
                                            <StackPanel Orientation="Vertical">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <TextBlock Text="Send download alerts if no activity for:" VerticalAlignment="Center"/>
                                                    <TextBox x:Name="txtAlertThreshold" Text="15" Style="{StaticResource ModernTextBox}" Width="auto" MaxWidth="100" Margin="12,0,0,0"/>
                                                    <TextBlock Text="minutes" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                                </StackPanel>

                                                <!-- New checkbox to control whether to send download/no-activity emails -->
                                                <CheckBox x:Name="chkSendDownloadAlerts" Content="Send download/no-activity alerts" Margin="0,12,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <!-- Help Text -->
                                    <Border Grid.Row="4" Background="#E7F3FF" BorderBrush="#007BFF" BorderThickness="1" CornerRadius="4" Padding="16" Margin="0,20,0,0">
                                        <StackPanel>
                                            <TextBlock Text="ℹ️ How it works:" FontWeight="SemiBold" FontSize="13"/>
                                            <TextBlock Text="• Errors and warnings are sent immediately when they occur" FontSize="12"/>
                                            <TextBlock Text="• Info summaries are collected and sent at the specified interval" FontSize="12"/>
                                            <TextBlock Text="• All alerts respect the schedule unless '24/7' is enabled" FontSize="12"/>
                                            <TextBlock Text="• Download alerts are triggered when no activity is detected for the threshold period" FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!-- About Page -->
            <Grid x:Name="AboutPage" Visibility="Collapsed">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="500">
                    <TextBlock Text="ℹ️" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                    <TextBlock Text="About FTP Monitor" Style="{StaticResource PageTitle}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Version 1.0.0" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                    <TextBlock Text="A powerful file monitoring and transfer application that helps you automatically download files from Linux FTP servers to your Windows machine." 
                               Style="{StaticResource PageSubtitle}" HorizontalAlignment="Center" TextWrapping="Wrap"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                        <Button Content="📧 Support" Style="{StaticResource SecondaryButton}" Margin="0,0,10,0"/>
                        <Button Content="🌐 Website" Style="{StaticResource SecondaryButton}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>

            <!-- Floating in-window sidebar was moved into the main content Grid to ensure it slides over content area -->
            <Border x:Name="FloatingSidebar" Background="#FAFAFA" BorderBrush="#E1DFDD" BorderThickness="2"
                    Width="260" VerticalAlignment="Stretch" HorizontalAlignment="Left" Visibility="Collapsed"
                    RenderTransformOrigin="0.5,0.5" Panel.ZIndex="10" ClipToBounds="True"
                    CornerRadius="16">
                <Border.RenderTransform>
                    <TranslateTransform X="-260" />
                </Border.RenderTransform>
                <StackPanel>
                    <Border Background="#0078D4" Padding="20" CornerRadius="16,16,0,0">
                        <StackPanel>
                            <TextBlock Text="FTP Monitor" FontSize="18" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="File Transfer Tool" FontSize="12" Foreground="#E1F5FE"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Margin="0,20,0,0">
                        <Button x:Name="btnFloatingNavMonitor" Style="{StaticResource NavButtonActive}" Click="BtnNavMonitor_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="📡" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Monitor" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="btnFloatingNavAlerts" Style="{StaticResource NavButton}" Click="BtnNavAlerts_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="🔔" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Alerts" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="btnFloatingNavSettings" Style="{StaticResource NavButton}" Click="BtnNavSettings_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="⚙️" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="Settings" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="btnFloatingNavAbout" Style="{StaticResource NavButton}" Click="BtnNavAbout_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ℹ️" FontSize="16" Margin="0,0,12,0"/>
                                <TextBlock Text="About" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    <!-- Bottom Status -->
                    <StackPanel VerticalAlignment="Bottom" Margin="20" Background="White"
           Height="100">
                        <Border CornerRadius="4" Padding="12" Background="#F8F9FA">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                    <Ellipse x:Name="ellipseFloatingNavStatus" Width="8" Height="8" Fill="#6BB6FF" 
                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBlock x:Name="txtFloatingNavStatus" Text="Ready" FontSize="12" FontWeight="SemiBold"/>
                                </StackPanel>

                                <TextBlock x:Name="txtFloatingNavFiles" Text="No files monitored" FontSize="11" Foreground="#605E55" Margin="0,2,0,0"/>
                                <TextBlock x:Name="txtFloatingNavRemote" Text="Remote: 0 files" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                                <TextBlock x:Name="txtFloatingNavErrors" Text="Errors: 0" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                                <TextBlock x:Name="txtFloatingNavLastCheck" Text="Last: Never" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                                <TextBlock x:Name="txtFloatingNavLastAlert" Text="Last alert: -" FontSize="11" Foreground="#605E5C" Margin="0,1,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>